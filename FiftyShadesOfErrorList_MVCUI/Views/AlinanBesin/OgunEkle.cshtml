@using FiftyShadesOfErrorList_MVCUI.Models.ViewModels;
@model AlinanBesinOgunEkleView
@{
	ViewData["Title"] = "OgunEkle";
}

<h1>Öğün Ekle</h1>

<section class="content">
	<div class="container-fluid">
		<div class="card card-default">
			<div class="card-header">
				<h3 class="card-title">Besin Seç</h3>

				<div class="card-tools">
					<button type="button" class="btn btn-tool" data-card-widget="collapse">
						<i class="fas fa-minus"></i>
					</button>
					<button type="button" class="btn btn-tool" data-card-widget="remove">
						<i class="fas fa-times"></i>
					</button>
				</div>
			</div>

			<div class="card-body">
				<div class="row">
					<div class="col-md-4">
						<div class="form-group">
							<label>Öğün Seçin</label>
							<select class="form-control" style="width: 100%; height:auto;" id="ogunSecim">
								<option value="Sabah">Sabah</option>
								<option value="Ogle">Öğle</option>
								<option value="Aksam">Akşam</option>
							</select>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-4">
						<div class="form-group">
							<label>Besin Ad</label>
							<select class="form-control select2" style="width: 100%; height:auto;" id="besinSecim">
								@foreach (var item in Model.Besinler)
								{
									<option id="@item.Id" data-porsiyon="@item.Porsiyon">@item.Ad</option>
								}
							</select>
						</div>
					</div>
					<div class="col-md-4">
						<div class="form-group">
							<label>Porsiyon</label>
							<input asp-for="Besin.Porsiyon" id="porsiyon" class="form-control" disabled />
						</div>
					</div>
					<div class="col-md-4">
						<div class="form-group">
							<label>Miktar</label>
							<input type="number" id="miktar" class="form-control"/>
						</div>
					</div>
				</div>
				<div class="d-flex justify-content-center">
					<a type="button" class="btn btn-success" onclick="OgunKaydet()" ><i class="fa-solid fa-pen-to-square"></i> Kaydet</a>
				</div>
			</div>
		</div>
	</div>
	<!-- Örneğin kullaniciId'yi bir data-* attribute'una gömerek -->
	<div id="kullaniciId" data-kullanici-id="@TempData["kullaniciId"]"></div>

</section>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
	// jQuery kullanarak select elementinin değişiklik olayını dinle
	$(document).ready(function () {
		$("#besinSecim").change(function () {
			// select elementinin değerini al
			var optionId = $("option:selected", this).attr("id");
			var porsiyonValue = $("option:selected", this).data("porsiyon");
			
			console.log(porsiyonValue);
			// Porsiyon inputuna değeri ekle
			$("#porsiyon").val(porsiyonValue);
		});
	});

	function OgunKaydet() {
		var besinId = $("option:selected", "#besinSecim").attr("id");
		var ogunAd = $("option:selected", "#ogunSecim").attr("value");
		var porsiyon = document.getElementById("miktar").value;

		// kullaniciId'yi al
		var kullaniciId = document.getElementById("kullaniciId").getAttribute("data-kullanici-id");

		console.log(porsiyon);
		$.ajax({
			url: '/AlinanBesin/OgunEkle',
			type: 'POST',
			data: { besinId: besinId, porsiyonMiktar: porsiyon, ogunAd: ogunAd, kullaniciId: kullaniciId },
			success: function (result) {
				window.location.href = '/AlinanBesin/Index/' + kullaniciId;
			},
			error: function (error) {
				console.log(error);
			}
		});
	}

</script>
